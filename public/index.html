<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Meatery Retell Control Panel</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }
      
      .container {
        max-width: 1400px;
        margin: 0 auto;
      }
      
      .header {
        text-align: center;
        margin-bottom: 30px;
      }
      
      h1 {
        color: white;
        font-size: 2.5rem;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        margin-bottom: 10px;
      }
      
      .subtitle {
        color: rgba(255,255,255,0.9);
        font-size: 1.1rem;
      }
      
      .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }
      
      @media (max-width: 968px) {
        .main-grid {
          grid-template-columns: 1fr;
        }
      }
      
      .card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        padding: 24px;
        transition: transform 0.2s, box-shadow 0.2s;
      }
      
      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 40px rgba(0,0,0,0.15);
      }
      
      .card h3 {
        color: #333;
        font-size: 1.3rem;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #667eea;
      }
      
      .quick-actions {
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        padding: 24px;
        margin-bottom: 20px;
      }
      
      .quick-actions h3 {
        color: #333;
        font-size: 1.3rem;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #667eea;
      }
      

      
      .quick-call-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
      }
      
      .quick-call-btn {
        padding: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
      }
      
      .quick-call-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102,126,234,0.4);
      }
      
      .quick-call-btn .name {
        font-size: 1.1rem;
      }
      
      .quick-call-btn .phone {
        font-size: 0.9rem;
        opacity: 0.9;
      }
      
      .form-row {
        margin-bottom: 16px;
      }
      
      label {
        display: block;
        color: #555;
        font-weight: 500;
        margin-bottom: 6px;
        font-size: 0.95rem;
      }
      
      input, select, textarea {
        width: 100%;
        padding: 10px 12px;
        border: 2px solid #e1e4e8;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.2s;
      }
      
      input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #667eea;
      }
      
      button {
        padding: 12px 24px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s, transform 0.2s;
      }
      
      button:hover {
        background: #5a67d8;
        transform: translateY(-1px);
      }
      
      button:active {
        transform: translateY(0);
      }
      
      .button-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      
      .button-group button {
        flex: 1;
        min-width: 120px;
      }
      
      .secondary-btn {
        background: #6b7280;
      }
      
      .secondary-btn:hover {
        background: #4b5563;
      }
      
      .danger-btn {
        background: #ef4444;
      }
      
      .danger-btn:hover {
        background: #dc2626;
      }
      
      .tuning-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 15px;
      }
      
      .tuning-item {
        display: flex;
        flex-direction: column;
      }
      
      .output-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        padding: 24px;
      }
      
      .output-section h3 {
        color: #333;
        font-size: 1.3rem;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #667eea;
      }
      
      #out {
        background: #f8f9fa;
        border: 2px solid #e1e4e8;
        border-radius: 8px;
        padding: 16px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.9rem;
        line-height: 1.5;
        overflow-x: auto;
        min-height: 200px;
        max-height: 500px;
        overflow-y: auto;
      }
      
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255,255,255,0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      .status-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-left: 10px;
      }
      
      .status-active {
        background: #10b981;
        color: white;
      }
      
      .status-inactive {
        background: #ef4444;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ü•© Meatery Retell Control Panel</h1>
        <p class="subtitle">Voice Agent Testing & Management Dashboard</p>
      </div>

      <!-- Quick Actions Section -->
      <div class="quick-actions">
        <h3>‚ö° Quick Test Calls</h3>
        
        <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border: 2px solid #0ea5e9;">
          <strong>ü§ñ Using Default Agent: llm_7eed186989d2fba11fa1f9395bc7</strong>
        </div>
        
        <div class="quick-call-buttons">
          <button class="quick-call-btn" onclick="quickCall('Nicholas', '+16194587071')">
            <span class="name">üì± Nicholas</span>
            <span class="phone">(619) 458-7071</span>
          </button>
          <button class="quick-call-btn" onclick="quickCall('Carlos', '+16198401121')">
            <span class="name">üì± Carlos</span>
            <span class="phone">(619) 840-1121</span>
          </button>
          <button class="quick-call-btn" onclick="quickCall('Tony', '+16196535347')">
            <span class="name">üì± Tony</span>
            <span class="phone">(619) 653-5347</span>
          </button>
          <button class="quick-call-btn" onclick="quickCall('Zach', '+18165471207')">
            <span class="name">üì± Zach</span>
            <span class="phone">(816) 547-1207</span>
          </button>
        </div>
      </div>

      <div class="main-grid">
        <!-- Single Call Section -->
        <div class="card">
          <h3>üìû Single Call</h3>
          <div class="form-row">
            <label>Phone Number</label>
            <input id="phone" placeholder="+16195551234" />
          </div>
          <div class="form-row">
            <label>Customer Name</label>
            <input id="name" placeholder="Nick" />
          </div>
          <div class="form-row">
            <label>Order Number</label>
            <input id="order" placeholder="12345" />
          </div>
          <div class="form-row">
            <label>From Number (E.164) (optional)</label>
            <input id="fromNumber" placeholder="+16195551234" />
          </div>
          <div class="form-row">
            <label>Max Follow-up Questions (optional)</label>
            <input id="maxFollowups" type="number" min="0" max="10" placeholder="2" />
          </div>
          <div class="form-row">
            <label>Resolution Preference (optional)</label>
            <input id="resolutionPref" placeholder="replace|refund|escalate" />
          </div>
          <button id="call" style="width: 100%;">üöÄ Place Call</button>
        </div>

        <!-- Batch Calls Section -->
        <div class="card">
          <h3>üìä Batch Calls</h3>
          <div class="form-row">
            <label>Lookback Hours</label>
            <input id="hours" type="number" value="48" />
          </div>
          <div class="form-row">
            <label>From Number (E.164) (optional)</label>
            <input id="batchFromNumber" placeholder="+16195551234" />
          </div>
          <div class="form-row">
            <label>Max Follow-up Questions (optional)</label>
            <input id="batchMaxFollowups" type="number" min="0" max="10" placeholder="2" />
          </div>
          <div class="form-row">
            <label>Resolution Preference (optional)</label>
            <input id="batchResolutionPref" placeholder="replace|refund|escalate" />
          </div>
          <div class="button-group">
            <button id="preview">üëÅÔ∏è Preview</button>
            <button id="batch">üéØ Start Batch</button>
          </div>
        </div>

        <!-- Agent Management Section -->
        <div class="card">
          <h3>ü§ñ Agent Management</h3>
          <div class="form-row">
            <label>Agent ID</label>
            <input id="agentIdView" placeholder="agent_..." />
          </div>
          <div class="button-group">
            <button id="listAgentsBtn">üìã List All</button>
            <button id="viewAgentBtn">üëÅÔ∏è View</button>
            <button id="syncAgentBtn" class="secondary-btn">üîÑ Sync</button>
          </div>
          
          <h4 style="margin-top: 20px; margin-bottom: 15px; color: #555;">‚öôÔ∏è Quick Tuning</h4>
          <div class="tuning-grid">
            <div class="tuning-item">
              <label>Voice Speed</label>
              <input id="voiceSpeed" type="number" min="0.5" max="1.6" step="0.05" value="0.85" />
            </div>
            <div class="tuning-item">
              <label>Voice Temperature</label>
              <input id="voiceTemp" type="number" min="0.5" max="1.5" step="0.05" value="0.7" />
            </div>
            <div class="tuning-item">
              <label>Backchannel Freq</label>
              <input id="backFreq" type="number" min="0" max="1" step="0.05" value="0.35" />
            </div>
            <div class="tuning-item">
              <label>Interruption Sensitivity</label>
              <input id="interrupt" type="number" min="0" max="1" step="0.05" value="0.85" />
            </div>
          </div>
          <button id="applyTuningBtn" style="width: 100%;">‚ú® Apply Tuning</button>
        </div>

        <!-- Additional Controls -->
        <div class="card">
          <h3>üõ†Ô∏è Additional Controls</h3>
          
          <div style="margin-bottom: 20px;">
            <h4 style="margin-bottom: 10px; color: #555;">üö´ Do Not Call List</h4>
            <div class="form-row">
              <label>Phone Number</label>
              <input id="dncPhone" placeholder="+16195551234" />
            </div>
            <div class="button-group">
              <button id="dncAddBtn" class="danger-btn">‚ûï Add to DNC</button>
              <button id="dncListBtn">üìã List DNC</button>
            </div>
          </div>

          <div>
            <h4 style="margin-bottom: 10px; color: #555;">üìà Calls Summary</h4>
            <div class="button-group">
              <button id="summaryBtn">üìä Get Summary</button>
              <button id="recentBtn">üïê Recent Events</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Output Section -->
      <div class="output-section">
        <h3>üì§ Output Console</h3>
        <pre id="out">Ready for commands...</pre>
      </div>
    </div>

    <script>
      const el = (id) => document.getElementById(id);
      const out = el('out');
      
      async function api(path, opts={}) {
        const res = await fetch(path, { 
          ...opts, 
          headers: { 
            'Content-Type': 'application/json', 
            ...(opts.headers||{}) 
          } 
        });
        if (!res.ok) throw new Error(await res.text());
        return res.json();
      }
      

      
      // Quick call function for team members
      async function quickCall(name, phone) {
        const defaultAgent = 'llm_7eed186989d2fba11fa1f9395bc7';
        
        out.textContent = `Calling ${name} at ${phone} with default agent: ${defaultAgent.substring(0, 12)}...`;
        
        try {
          const data = await api('/call', { 
            method: 'POST', 
            body: JSON.stringify({
              phone: phone,
              name: name,
              orderNumber: 'TEST-' + Date.now(),
              metadata: {
                test_call: true,
                initiated_by: 'quick_call_button'
              }
            })
          });
          out.textContent = `Call initiated to ${name}!\n\n` + JSON.stringify(data, null, 2);
        } catch (e) { 
          out.textContent = `Failed to call ${name}: ${e.message}`; 
        }
      }
      
      // Single call
      el('call').onclick = async () => {
        out.textContent = 'Placing call...';
        try {
          const data = await api('/call', { 
            method: 'POST', 
            body: JSON.stringify({
              phone: el('phone').value,
              name: el('name').value,
              orderNumber: el('order').value,
              fromNumber: el('fromNumber').value || undefined,
              metadata: {
                max_followup_questions: el('maxFollowups').value ? Number(el('maxFollowups').value) : undefined,
                resolution_preference: el('resolutionPref').value || undefined
              }
            })
          });
          out.textContent = 'Call placed successfully!\n\n' + JSON.stringify(data, null, 2);
        } catch (e) { 
          out.textContent = 'Error: ' + e.message; 
        }
      };

      // Preview candidates
      el('preview').onclick = async () => {
        out.textContent = 'Loading candidates...';
        try {
          const hours = Number(el('hours').value || 48);
          const data = await api('/candidates?hours=' + hours);
          out.textContent = `Found ${data.length} candidates:\n\n` + JSON.stringify(data, null, 2);
        } catch (e) { 
          out.textContent = 'Error: ' + e.message; 
        }
      };

      // Batch calls
      el('batch').onclick = async () => {
        out.textContent = 'Starting batch calls...';
        try {
          const data = await api('/call/batch', { 
            method: 'POST', 
            body: JSON.stringify({
              hours: Number(el('hours').value || 48),
              fromNumber: el('batchFromNumber').value || undefined,
              max_followup_questions: el('batchMaxFollowups').value ? Number(el('batchMaxFollowups').value) : undefined,
              resolution_preference: el('batchResolutionPref').value || undefined
            })
          });
          out.textContent = 'Batch started!\n\n' + JSON.stringify(data, null, 2);
        } catch (e) { 
          out.textContent = 'Error: ' + e.message; 
        }
      };

      // Agent management
      el('listAgentsBtn').onclick = async () => {
        try { 
          const agents = await api('/agents');
          out.textContent = `Found ${agents.length} agents:\n\n` + JSON.stringify(agents, null, 2); 
        } catch (e) { 
          out.textContent = 'Error: ' + e.message; 
        }
      };
      
      el('viewAgentBtn').onclick = async () => {
        try { 
          const agent = await api('/agents/' + el('agentIdView').value);
          out.textContent = 'Agent details:\n\n' + JSON.stringify(agent, null, 2); 
        } catch (e) { 
          out.textContent = 'Error: ' + e.message; 
        }
      };
      
      el('syncAgentBtn').onclick = async () => {
        try { 
          const result = await api('/agents/' + el('agentIdView').value + '/sync-defaults', { 
            method: 'POST', 
            body: JSON.stringify({ overrideWebhookToApp: true }) 
          });
          out.textContent = 'Agent synced!\n\n' + JSON.stringify(result, null, 2); 
        } catch (e) { 
          out.textContent = 'Error: ' + e.message; 
        }
      };

      // Apply tuning
      el('applyTuningBtn').onclick = async () => {
        try {
          const id = el('agentIdView').value;
          if (!id) {
            out.textContent = 'Please enter an Agent ID first';
            return;
          }
          const body = {
            voice_speed: Number(el('voiceSpeed').value),
            voice_temperature: Number(el('voiceTemp').value),
            backchannel_frequency: Number(el('backFreq').value),
            interruption_sensitivity: Number(el('interrupt').value)
          };
          const res = await api('/agents/' + id, { 
            method: 'PATCH', 
            body: JSON.stringify(body) 
          });
          out.textContent = 'Tuning applied!\n\n' + JSON.stringify(res, null, 2);
        } catch (e) { 
          out.textContent = 'Error: ' + e.message; 
        }
      };

      // DNC management
      el('dncAddBtn').onclick = async () => {
        try { 
          const result = await api('/opt-out', { 
            method: 'POST', 
            body: JSON.stringify({ phone: el('dncPhone').value }) 
          });
          out.textContent = 'Added to DNC list!\n\n' + JSON.stringify(result, null, 2); 
        } catch (e) { 
          out.textContent = 'Error: ' + e.message; 
        }
      };
      
      el('dncListBtn').onclick = async () => {
        try { 
          const list = await api('/dnc');
          out.textContent = `DNC List (${list.length} numbers):\n\n` + JSON.stringify(list, null, 2); 
        } catch (e) { 
          out.textContent = 'Error: ' + e.message; 
        }
      };

      // Call summaries
      el('summaryBtn').onclick = async () => {
        try { 
          const summary = await api('/calls/summary');
          out.textContent = 'Calls Summary:\n\n' + JSON.stringify(summary, null, 2); 
        } catch (e) { 
          out.textContent = 'Error: ' + e.message; 
        }
      };
      
      el('recentBtn').onclick = async () => {
        try { 
          const events = await api('/calls/recent-log?limit=50');
          out.textContent = 'Recent Webhook Events:\n\n' + JSON.stringify(events, null, 2); 
        } catch (e) { 
          out.textContent = 'Error: ' + e.message; 
        }
      };
      
      // Initialize page on load
      window.addEventListener('DOMContentLoaded', () => {
        out.textContent = 'Ready for commands... Using default agent: llm_7eed186989d2fba11fa1f9395bc7';
      });
    </script>
  </body>
</html>